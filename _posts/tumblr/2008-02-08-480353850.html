---
layout: post
title: Test-driven development on Rails
---

<p>Comecei um projeto pessoal, que já vi um muito bom rodando, <a href="http://spesa.com.br" title="Spesa - Gerenciador Financeiro" target="_blank">Spesa</a>, feito pelo <a href="http://simplesideias.com.br/" title="Blog do Nando Vieira" target="_blank">Nando Vieira</a> (sempre queria saber quem tinha criado o spesa, e por acaso descobri) e outro no <a href="http://groups.google.com/group/rails-br/browse_thread/thread/db8bee2f2b2c8637?hl=pt-BR" title="Finanças on Rails" target="_blank">rails-br</a> bem interessante, em AJAX.</p>



<p>Após isso, tambem resolvi fazer o meu gerenciador financeiro! Assim como o Nando Vieira, irei colocar todas as regras de negocio realmente no negocio, evitando deixar tudo em Stored Procedures.</p>



<p>Nesse projeto, resolvi usar utilizar esta tecnica, e segui um <a href="http://simplesideias.com.br/tdd-no-rails-unit-tests/" title="unit tests" target="_blank">tutorial rapído</a> do Nando Vieira.</p>



<p>Depois de implementar 12 testes, tive problemas com dois, e achei uma coisa estranha, fiz passar, mas eu acho que tem alguma coisa errado, e não é no codigo implementado.</p>



<p>O método MD5.hexdigest() retorna uma hash MD5, e para o teste, faço a comparação da String que estou criado pro objeto user com a mesma string passando direto pelo método.</p>



<p><code>assert_equal(Digest::MD5.hexdigest("caironoleto"), user.password)</code></p>



<p>Só que a MD5 experada é diferente da MD5 que é passada, mesmo sendo os mesmos métodos, e mesmo sendo a mesma String.</p>



<p>Para resolver, antes de salvar o objeto, atribui o valor a uma nova variavel, assim criando a MD5 correta.</p>



<p><code><br/>

def test_of_password_in_new_user<br/>

user = create(:password =&gt; "caironoleto")<br/>

expected = user.password<br/>

user.save<br/>

assert_equal(Digest::MD5.hexdigest(expected), user.password)<br/>

end<br/></code><br/>

Se algum railer ver, por favor, deixa comentario e explica o que está acontecendo.</p>



<p>Até a proxima!</p>



<p><b>UPDATE:</b></p>



<p>Realmente tem uma coisa estranha! E a pior das coisas, ela está entre o computador e a cadeira! (HoiahoiehAOIEHaO).</p>



<p>Simplesmente o código estava errado, nem métodos, ou nada disso, e sim o que estava fazendo.</p>



<p>Simplesmente por que quando utilizo o método create, ele realmente cria, aplicando assim a validação que passei pelo modelo e já salvando o objeto no banco de dados. E depois, eu mandava ele &#8220;salvar&#8221; repetindo a mesma coisa. Só que fazendo a MD5 da MD5 que já estava lá, gerando erro quando tentava comparar a MD5 direta pelo método Digest::MD5.hexadigest(&#8220;caironoleto&#8221;).</p>



<p>O que eu tava fazendo aí em cima dava certo, por que ele está armazendo em expected a MD5 que foi criada.</p>



<p>Agora sim respiro aliviado!</p>



<p>Até a proxima!</p>
