
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Cairo Noleto</title>
  <meta name="author" content="Cairo Noleto">

  
  <meta name="description" content="No dia 20/10 foi lançado a versão 3.3.2 desse framework de testes. Foram adicionados algumas funcionalidades e corrigidas vários bugs. Quem já tem &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://caironoleto.github.com/page/6">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Cairo Noleto" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Cairo Noleto</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:caironoleto.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/10/29/noticias-sobre-phpunit/">Notícias sobre PHPUnit</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-10-29T00:00:00-03:00" pubdate data-updated="true">Oct 29<span>th</span>, 2008</time>
        
         | <a href="/2008/10/29/noticias-sobre-phpunit/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>No dia 20/10 foi lançado a versão 3.3.2 desse framework de testes.</p>

<p>Foram adicionados algumas funcionalidades e corrigidas vários bugs. Quem já tem instalado o PHPUnit sobre o pear, apenas faça o upgrade</p>

<p><code>sudo pear upgrade phpunit/PHPUnit</code></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/10/28/quer-ganhar-um-ingresso-para-o-php-conference/">Que ganhar um ingresso para o PHP Conference?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-10-28T00:00:00-03:00" pubdate data-updated="true">Oct 28<span>th</span>, 2008</time>
        
         | <a href="/2008/10/28/quer-ganhar-um-ingresso-para-o-php-conference/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Quer ganhar?! Então faz o seguinte:</p>

<p>Escreve uma frase bem legal sobre o que você ai encontrar lá, imagina aí um milhão de coisas :P</p>

<p>As duas melhores frases vão ganhar um ingresso para curtir o PHP Conference junto com a galera da Add4 Comunicação!!</p>

<p>Então não vacila, da uma olhada <a href="http://www.add4.com.br/blog/2008/10/phpconference-brasil-promocao/">aqui</a> e tenha mais detalhes sobre essa promoção :D</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/10/27/create--update--destroy--e-index-nao-sao-obrigatorios/">Create, update, destroy e index não são obrigatórios!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-10-27T00:00:00-03:00" pubdate data-updated="true">Oct 27<span>th</span>, 2008</time>
        
         | <a href="/2008/10/27/create--update--destroy--e-index-nao-sao-obrigatorios/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Olá, mas que titulo é esse? O que quer dizer isso!?</p>

<p>Eu acompanho e muito a comunidade RubyOnRails brasileira, e tenho notado um comportamento que vem tomando conta principalmente nos novatos, que é o de querer a obrigatoriedade dos métodos index, create, update e destroy.</p>

<p>Como todos sabemos, temos que adicionar, remover e atualizar nossos dados, em alguns casos específicos listar todos os dados, mas isso não é obrigatório, bem como o nome desses métodos não são obrigatórios!</p>

<p>Ao invés de utilizar o método index para listar, posso utilizar o método show_all para mostrar todos algo como users/show_all.</p>

<p>Eu acho que esse comportamento está derivando do mal uso do scaffold. Para quem ainda não entendeu, scaffold é para gerar uma estrutura INICIAL para seus clientes alimentarem os dados de seus sistemas. Não é para ser usado como a roda que gira o mundo ou como &#8220;The golden bullet&#8221;. O scaffold deve ser usado em casos especificos, geralmente usados no inicio do desenvolvimento em apoio para os desenvolvedores lidarem com dados reais da aplicação ou quando a demanda de dados do cliente não pode parar.</p>

<p>Não usem scaffold para se gabar a seus amigos:</p>

<p><strong>&#8220;Duas linhas de código e já estava pronto&#8221;</strong> ou <strong>&#8220;Que ver eu fazer um blog em 15 minutos?!&#8221;</strong></p>

<p>Usem com consciência:</p>

<p><strong>&#8220;Maria, aqui está o formulário inicial para entrada dos dados relativo a nova categoria de imóveis, até o final do dia de amanhã eu irei te mostrar como a tela realmente irá funcionar, enquanto não fica finalizado, você já pode começar a trabalhar&#8221;</strong>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/10/21/traducao--rails-database-migrations---parte-ii/">Tradução: Rails database Migrations - Parte II</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-10-21T00:00:00-03:00" pubdate data-updated="true">Oct 21<span>st</span>, 2008</time>
        
         | <a href="/2008/10/21/traducao--rails-database-migrations---parte-ii/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Esta é a segunda parte da tradução do <a href="http://guide.rails.info/migrations.html">artigo Rails database Migrations</a>. Mais uma vez, antes de desfrutarem da leitura, quero dizer-lhes que se encontrar erros de português ou a tradução com sentido diferente, por favor, comuniquem-me! Avisem-me por email, twitter (<a href="http://twitter.com/caironoleto">caironoleto</a>), ou qualquer mensageiro!! :P</p>

<ul>
<li><a href="/2008/09/23/traducao--rails-database-migrations---parte-i">Rails Database Migrations - Parte I</a></li>
</ul>


<h3>2.0 Criando migrações</h3>

<h3>2.1 Criando um Modelo</h3>

<p>Um Modelo e os geradores de scaffold criará migrações apropriadas para criação de um novo Modelo. Esta migração contém instruções prontas para criação de uma tabela relevante. Se você mostrar pro Rails as colunas que você precisa então as declarações já estarão criadas. Por exemplo, rodando <code>ruby script/generate model Product name:string description:text</code> gerará uma migração como esta</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">CreateProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
</span><span class='line'>    <span class="n">create_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:name</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">text</span> <span class="ss">:description</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>
</span><span class='line'>    <span class="n">drop_table</span> <span class="ss">:products</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Você pode adicionar quantos nomes/tipo de colunas como você deseja. Por padrão <code>t.timestamps</code> (Que criam as colunas <code>updated_at</code> e <code>created_at</code> que serão populadas automáticamentes pelo Rails) podem ser adicionadas para você.</p>

<h3>2.2 Criando uma migração autônoma</h3>

<p>Se você criar uma migração para outros propósitos (Por exemplo, adicionar uma coluna numa tabela já existente) então você pode usar o gerador de migrações:</p>

<p><code>ruby script/generate migration AddPartNumberToProducts</code></p>

<p>Criará uma migração vazia mas já apropriada com o nome da migração:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">AddPartNumberToProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Se o nome da migração é na forma AddXXXtoYYY ou RemoveXXXtoYYY e for seguida de uma lista de nomes de colunas e seus tipos então a migração será criada contendo declarações apropriadas para adicionar e remover colunas.</p>

<p><code>ruby script/generate migration AddPartNumberToProducts part_number:string</code></p>

<p>Gerará:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">AddPartNumberToProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
</span><span class='line'>    <span class="n">add_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:part_number</span><span class="p">,</span> <span class="ss">:string</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>
</span><span class='line'>    <span class="n">remove_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:part_number</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Similarmente:</p>

<p><code>ruby script/generate migration RemovePartNumberFromProducts part_number:string</code></p>

<p>gerará</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">RemovePartNumberFromProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
</span><span class='line'>    <span class="n">remove_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:part_number</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>
</span><span class='line'>    <span class="n">add_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:part_number</span><span class="p">,</span> <span class="ss">:string</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>E você não está limitado a gerar magicamente apenas uma coluna, por exemplo</p>

<p><code>ruby script/generate migration AddDetailsToProducts part_number:string price:decimal</code></p>

<p>gerará</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">AddDetailsToProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
</span><span class='line'>    <span class="n">add_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:part_number</span><span class="p">,</span> <span class="ss">:string</span>
</span><span class='line'>    <span class="n">add_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:price</span><span class="p">,</span> <span class="ss">:decimal</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>
</span><span class='line'>    <span class="n">remove_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:price</span>
</span><span class='line'>    <span class="n">remove_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:part_number</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>E sempre o que foi gerado é apenas um ponto de partida, você pode adicionar ou remover a partir dele o que você quiser, como você achar melhor.</p>

<h3>3.0 Escrevendo uma migração</h3>

<p>Uma vez que você criou uma migração usando um dos geradores, é a hora de trabalhar!</p>

<h3>3.1 Criando uma tabela</h3>

<p><code>create_table</code> será um dos métodos mais usados. Tipicamente usada assim</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">create_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:name</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>criará uma tabela <code>products</code> com uma coluna chamada <code>name</code> (e como discutido anteriormente, implicitamente criará uma coluna id).</p>

<p>O objeto &#8220;renderizado&#8221; (yielded) no bloco permite você criar colunas na tabela. Existe duas formas de se fazer isso. A primeira é algo assim</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">create_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">column</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:string</span><span class="p">,</span> <span class="ss">:null</span> <span class="o">=&gt;</span> <span class="kp">false</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>a segunda forma, que é chamada de migração &#8220;sexy&#8221;, que elimina redundância dos métodos. Em vez de <code>string</code>, <code>integer</code>, etc os métodos são criados a partir do tipo da coluna, onde os parâmetros subseqüentes são idênticos.</p>

<p>Por padrão <code>create_table</code> criará uma chave primária chamada <code>id</code>. Você pode alterar o nome da chave primária com a opção <code>:primary_key</code> (Não esqueça de atualizar o modelo correspondente) ou se você não precisar de uma chave primária (por exemplo HABTM (<a href="http://wiki.rubyonrails.org/rails/pages/has_and_belongs_to_many">has and belongs to many</a>) join table) você pode passar <code>:id =&gt; false</code>. Se você precisa passar alguma informação específica, você pode passar um fragmento SQL na opção <code>:options</code>. Por exemplo:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">create_table</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:options</span> <span class="o">=&gt;</span> <span class="s2">&quot;ENGINE=BLACKHOLE&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:null</span> <span class="o">=&gt;</span> <span class="kp">false</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Irá anexar <code>ENGINE=BLACKHOLE</code> na sql usada para criar a tabela (Quando se usa MySQL por padrão é usado &#8220;ENGINE=InnoDB&#8221;).</p>

<p>Os tipos que o Active Record suporta são <code>:primary_key</code>, <code>:string</code>, <code>:text</code>, <code>:integer</code>, <code>:float</code>, <code>:decimal</code>, <code>:datetime</code>, <code>:timestamp</code>, <code>:time</code>, <code>:date</code>, <code>:binary</code>, <code>:boolean</code>.</p>

<p>Eles vão ser mapeados apropriadamente para cada banco de dados, por exemplo com MySQL <code>:string</code> é mapeada para <code>VARCHAR(255)</code>. Você pode criar colunas e tipos não suportados pelo Active Record usando uma sintaxe não sexy, por exemplo:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">create_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">column</span> <span class="ss">:name</span><span class="p">,</span> <span class="s1">&#39;polygon&#39;</span><span class="p">,</span> <span class="ss">:null</span> <span class="o">=&gt;</span> <span class="kp">false</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Esta forma, no entanto, dificulta a portabilidade para outros banco de dados.</p>

<h3>3.2 Mudando tabelas</h3>

<p>O primo mais próximo de <code>create_table</code> é <code>change_table</code>. Usado para alterar tabelas existentes, é similarmente usada como o <code>create_table</code> mas o objeto &#8220;rendenrizado&#8221; (yielded) para o bloco conhece mais truques. Por exemplo</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">change_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">remove</span> <span class="ss">:description</span><span class="p">,</span> <span class="ss">:name</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:part_number</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">index</span> <span class="ss">:part_number</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">rename</span> <span class="ss">:upccode</span><span class="p">,</span> <span class="ss">:upc_code</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>remove a coluna <code>description</code> e <code>name</code>, adiciona a coluna <code>part_number</code> e adiciona um index nesta mesma coluna. E por ultimo altera o nome da coluna <code>upccode</code>. É o mesmo que fazer</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">remove_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:description</span>
</span><span class='line'><span class="n">remove_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:name</span>
</span><span class='line'><span class="n">add_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:part_number</span><span class="p">,</span> <span class="ss">:string</span>
</span><span class='line'><span class="n">add_index</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:part_number</span>
</span><span class='line'><span class="n">rename_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:upccode</span><span class="p">,</span> <span class="ss">:upc_code</span>
</span></code></pre></td></tr></table></div></figure>


<p>Você não deve manter repetindo o nome da tabela e de todos os grupos de declarações relatados para modificar uma tabela em particular. Em uma transformação individual os nomes são curtos, por exemplo <code>remove_column</code> torna-se <code>remove</code> e <code>add_index</code> torna-se <code>index</code>.</p>

<h3>3.3 Helpers especiais</h3>

<p>O Active Record provê alguns atalhos para as funcionalidades mais comuns. Por exemplo, é muito comum adicionar as colunas <code>created_at</code>e <code>updated_at</code> e o método que faz exatamente isso é:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">create_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Criará uma tabela products com essas duas colunas</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">change_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Adiciona essas duas colunas a uma tabela existente.</p>

<p>Outro helper é chamado de <code>references</code> (Também disponível como <code>belongs_to</code> ). Na sua forma mais simples adiciona alguma habilidade de reutilização.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">create_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">references</span> <span class="ss">:category</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>então criará a coluna <code>category_id</code> com o tipo apropriado. Note que você deve passar o nome do modelo e não da coluna. O Active Record adicionará o sufixo _id para você. Se você tiver uma associação <code>belongs_to</code> polimórfica então <code>references</code> irá adicionar as colunas referidas</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">create_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">references</span> <span class="ss">:attachment</span><span class="p">,</span> <span class="ss">:polymorphic</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="s1">&#39;Photo&#39;</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>irá adicionar a coluna <code>attachment_id</code> e a coluna <code>attachment_type</code> com o valor padrão Photo.</p>

<p>Se os helpers fornecidos pelo Active Record não for suficiente, você pode utilizar a função <code>execute</code> para executar SQL arbitrárias.</p>

<p>Para mais detalhes e exemplos de métodos individuais dê uma olhada na documentação da API, em particular a documentação para <a href="http://api.rubyonrails.com/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html">ActiveRecord::ConnectionAdapters::SchemaStatements</a> (na qual provê os métodos disponíveis nos métodos <code>up</code> e <code>down</code>), <a href="http://api.rubyonrails.com/classes/ActiveRecord/ConnectionAdapters/TableDefinition.html">ActiveRecord::ConnectionAdapters::TableDefinition</a> (na qual provê os métodos disponíveis para o objeto &#8220;rendenrizado&#8221; (yielded) por <code>create_table</code>) e o <a href="http://api.rubyonrails.com/classes/ActiveRecord/ConnectionAdapters/Table.html">ActiveRecord::ConnectionAdapters::Table</a> (na qual fornece os métodos disponíveis para o objeto &#8220;rendenrizado&#8221; (yielded) por <code>change_table</code>).</p>

<h3>3.4 Escrevendo seu método down</h3>

<p>O método <code>down</code> da sua migração deve reverter as transformações concluídas pelo método <code>up</code>. Em outras palavras, o banco de dados deve se manter inalterado se você fizer um <code>up</code> seguido de um <code>down</code>. Por exemplo, se você criar uma tabela no método <code>up</code> você deverá excluí-la no método <code>down</code>. Deve ser inteligente e precisamente inverso ao método <code>up</code>. Por exemplo</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ExampleMigration</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
</span><span class='line'>    <span class="n">create_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">references</span> <span class="ss">:category</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="c1">#add a foreign key</span>
</span><span class='line'>    <span class="n">execute</span> <span class="s2">&quot;ALTER TABLE products ADD CONSTRAINT fk_products_categories FOREIGN KEY (category_id) REFERENCES categories(id)&quot;</span>
</span><span class='line'>    <span class="n">add_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:home_page_url</span><span class="p">,</span> <span class="ss">:string</span>
</span><span class='line'>    <span class="n">rename_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:email_address</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>
</span><span class='line'>    <span class="n">rename_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:email_address</span><span class="p">,</span> <span class="ss">:email</span>
</span><span class='line'>    <span class="n">remove_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:home_page_url</span>
</span><span class='line'>    <span class="n">execute</span> <span class="s2">&quot;ALTER TABLE products DROP FOREIGN KEY fk_products_categories&quot;</span>
</span><span class='line'>    <span class="n">drop_table</span> <span class="ss">:products</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>as vezes a sua migração pode fazer algumas coisas irreversíveis, por exemplo quando você destrói alguns dados. Em casos como esse onde você não pode reverter uma migração, você pode lançar IrreversibleMigration para o seu método <code>down</code>. Se alguém tentar reverter a sua migração uma mensagem será mostrada falando que ela não será completa.</p>

<p>E aqui finaliza a segunda parte do artigo.</p>

<ul>
<li><a href="/2008/11/04/traducao--rails-database-migrations---parte-iii">Continuação: Rails Database Migrations - Parte III</a></li>
<li><a href="/2008/11/12/traducao--rails-database-migrations---parte-iv">Continuação: Rails Database Migrations - Parte IV</a></li>
</ul>


<p>Até a próxima!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/10/13/meus-plugins-do-gedit-no-github/">Meus plugins do Gedit no GitHub</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-10-13T00:00:00-03:00" pubdate data-updated="true">Oct 13<span>th</span>, 2008</time>
        
         | <a href="/2008/10/13/meus-plugins-do-gedit-no-github/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Olá, um post rápido, apenas para dizer que está no <a href="https://github.com/caironoleto/my-gedit-plugins">Github</a> meus plugins do Gedit.</p>

<p>Até a próxima!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/10/10/off-topic--eu-quero-estudar-o-que-eu-quero/">Off-Topic: Eu quero estudar o que eu quero!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-10-10T00:00:00-03:00" pubdate data-updated="true">Oct 10<span>th</span>, 2008</time>
        
         | <a href="/2008/10/10/off-topic--eu-quero-estudar-o-que-eu-quero/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Estou no ultimo período da faculdade e sinceramente, não aguento mais! Não aguento mais não ter tempo de estudar o que realmente eu quero, para estudar algo que eu vejo que não vai ter utilidade, pelo menos por enquanto.</p>

<p>É realmente muito bom estudar, mas algo que você goste. Eu falo muito para meus amigos que a melhor época do ano é quando estou de férias da faculdade, mas não por que eu fico sem aula, e sim porque eu tenho o tempo que eu quero para estudar o que eu quero!</p>

<p>A educação no Brasil tem um grande problema que é de não escutar realmente quem é o mais importante na história toda, os alunos. Temos uma política de que aluno bom é somente o que passa de ano, é o aluno medíocre, expressão que o Fábio Akita tanto fala, é aquele que esta na média e que não pode se esforçar mais.</p>

<p>É uma política de esmola que acaba no final apenas remediando e não curando tudo que acontece. Agora o emprego é fazer mais filhos para eles irem para escola para poder ganhar mais dinheiro do governo. Podendo pegar esse dinheiro e investir em novas escolas e na melhoria do salário dos professores, fazendo com que pelo menos os filhos dessas pessoas possam ter alguma chance no futuro, e não apenas mais um pegador de esmola do governo.</p>

<p>Eu realmente só precisava desabafar :D Esse não é um post técnico, não é um post Ágil, é apenas um desabafo.</p>

<p><code>#prontofalei</code></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/10/08/phpburn-no-github/">PHPBurn no GitHub</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-10-08T00:00:00-03:00" pubdate data-updated="true">Oct 8<span>th</span>, 2008</time>
        
         | <a href="/2008/10/08/phpburn-no-github/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Nós migramos o <a href="http://www.phpburn.com">PHPBurn</a> para o <a href="http://github.com/klederson">GitHub</a>, então se você tiver vontade de nos ajudar a transformar este ORM faça um fork do projeto e depois nos mande um pull request!</p>

<p>Outra coisa é que quem estiver afim de ganhar uma camiseta, ter um desconto na entrada da <a href="http://www.phpconf.com.br/">PHP Conference 2008</a> e se juntar a galera da <a href="http://www.add4.com.br">Add4 Comunicação</a>, basta entrar em contato por aqui ou por comercial at add4 ponto com ponto br.</p>

<p>Vamos mudar o mundo, fazer um ORM que consuma menos memória, seja mais rápido, menos burocrático, mais simples e fácil de usar, assim ajudaremos a natureza reduzindo consumo de energia e diminuindo a emissão de CO² :P</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/10/04/php-conference-2008-eu-vou/">PHP Conference 2008, eu vou!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-10-04T00:00:00-03:00" pubdate data-updated="true">Oct 4<span>th</span>, 2008</time>
        
         | <a href="/2008/10/04/php-conference-2008-eu-vou/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Não sei se vocês perceberam, mas coloquei um mini banner do <a href="http://www.phpconf.com.br">PHP Conference 2008</a> e sim, eu vou participar, eu e toda a equipe da <a href="http://www.add4.com.br">Add4 Comunicação</a>.</p>

<p>O Klederson Bueno, diretor da Add4 Comunicação, encaminhou uma palestra sobre o <a href="http://www.phpburn.com">PHPBurn</a> e nós vamos apresentá-lo a toda a comunidade, ver as reais necessidades, discutir pontos, enfim, realmente fazer o lançamento.</p>

<p>O PHP Conference vai acontecer de 27 a 29 de Novembro em Osasco. Quem ainda não fez a inscrição, corre lá e faz para assistir nossa palestra :D</p>

<p>E mais sobre o PHPBurn, nós o migramos para o <a href="https://github.com/klederson/phpburn">Github</a>, então que tiver interessado em fazer um fork e contribuir, seja bem vindo!</p>

<p>Até a próxima!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/09/23/traducao--rails-database-migrations---parte-i/">Tradução: Rails database Migrations - Parte I</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-09-23T00:00:00-03:00" pubdate data-updated="true">Sep 23<span>rd</span>, 2008</time>
        
         | <a href="/2008/09/23/traducao--rails-database-migrations---parte-i/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Olá, este é o primeiro de quatro partes <a href="http://guide.rails.info/migrations.html">desse artigo</a> sobre as Migrations do Rails. Antes de se desfrutarem da leitura quero dizer-lhes que se encontrar erros de português ou a tradução com sentido diferente, por favor, comuniquem-me! Avisem-me por email, twitter (<a href="http://twitter.com/caironoleto">caironoleto</a>), ou qualquer mensageiro!! :P</p>

<h3>Migrações em Banco de Dados em Rails</h3>

<p>Migrações é a forma conveniente de você alterar seu banco de dados de uma maneira organizada e estruturada. Você poderia editar fragmentos de SQL na mão mas você teria a responsabilidade de comunicar aos outros desenvolvedores que eles precisam ir lá e executá-los. Você também necessita acompanhar as mudanças na máquina de produção na próxima vez que você for fazer deploy. O Active Record marca as migrações que já foram executadas e tudo que você precisa fazer é atualizar seu código e rodar rake db:migrate. O Active Record irá trabalhar para que suas migrações sejam executadas.</p>

<p>Migrações é a forma de você descrever essas transformações usando Ruby. A grande coisa disso tudo (como muito das funcionalidades do Active Record) é a independência do banco de dados: você não precisa se preocupar com mais nenhuma sintaxe para CREATE TABLE, ou que você se preocupe sobre variações de SELECT * (você pode abstrair os requisitos específicos de banco de dados SQL). Por exemplo, você poderia usar SQLite 3 no desenvolvimento, mas MySQL em produção.</p>

<p>Você aprenderá tudo sobre migrações incluindo:</p>

<ul>
<li>Os geradores que você pode usar para criá-los</li>
<li>Os métodos que o Active Record provê para manipular seu banco de dados</li>
<li>As tarefas Rake que você pode manipular</li>
<li>Como eles são relativo ao schema.rb</li>
</ul>


<h3>1. Anatomia de uma migração</h3>

<p>Antes de eu mergulhar nos detalhes de uma migração, aqui estão alguns exemplos curtos de coisas que você pode fazer:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">CreateProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
</span><span class='line'>    <span class="n">create_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:name</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">text</span> <span class="ss">:description</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>
</span><span class='line'>    <span class="n">drop_table</span> <span class="ss">:products</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Essa migração adiciona uma tabela chamada <code>products</code> com uma coluna string chamada <code>name</code> e uma coluna text chamada <code>description</code>. Uma chave primária chamada id também será adicionada, no entanto por padrão, não precisamos pedir isso. As colunas timestamps <code>created_at</code> e <code>updated_at</code> que o Active Record preenche automaticamente também são adicionadas. Revertendo essa migração simplesmente remove a tabela.</p>

<p>Migrações não tem limite para alterar o esquema. Você pode usar para corrigir dados errados no banco de dados ou popular novos campos:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">AddReceiveNewsletterToUsers</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
</span><span class='line'>    <span class="n">change_table</span> <span class="ss">:users</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">boolean</span> <span class="ss">:receive_newsletter</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="kp">false</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="no">User</span><span class="o">.</span><span class="n">update_all</span> <span class="o">[</span><span class="s2">&quot;receive_newsletter = ?&quot;</span><span class="p">,</span> <span class="kp">true</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>
</span><span class='line'>    <span class="n">remove_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:receive_newsletter</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Esta migração adiciona a coluna <code>receive_newsletter</code> para a tabela users. Nós queremos que o padrão seja falso para novos usuários, mas para os usuários existentes nos consideramos que eles já fizeram a sua opção, então nos usamos o modelo User para setar a bandeira para true para usuários existentes.</p>

<h3>1.1 Migrações são classes</h3>

<p>A migração é uma subclasse de ActiveRecord::Migration que implementa dois métodos: up (para realizar as transformações exigidas) e down (reverte o que foi feito).</p>

<p>O Active Record prover métodos para executar as tarefas comuns na definição dos dados independente do banco de dados (Você verá mais detalhes mais tarde):</p>

<ul>
<li><code>create_table</code></li>
<li><code>change_table</code></li>
<li><code>drop_table</code></li>
<li><code>add_column</code></li>
<li><code>remove_column</code></li>
<li><code>change_column</code></li>
<li><code>rename_column</code></li>
<li><code>add_index</code></li>
<li><code>remove_index</code></li>
</ul>


<p>Se você precisa executar tarefas específicas para seu banco de dados (por exemplo, criar uma chave estrangeira) então a função <code>execute</code>permite executar SQL arbitrarias. As migrações é apenas uma classe regular em Ruby, então você não esta limitado a apenas essas funções. Por exemplo, após adicionar uma coluna, você pode escrever código para setar o valor dessa coluna para dados existentes (se necessário usando seus modelos).</p>

<h3>1.2 O que está no nome</h3>

<p>Migrações sao armazenadas em arquivos em <code>db/migrate</code>, uma para cada classe de migração. O nome dos arquivos é na forma de <code>YYYYMMDDHHMMSS_create_products.rb</code>, ou seja, uma hora UTC identificando a migração seguida de um sublinhado e seguido do nome da migração. O Nome da classe de migração deve bater com a ultima parte do arquivo. Por exemplo, <code>20080906120000_create_products.rb</code> deveria definir CreateProducts e <code>20080906120001_add_details_to_products.rb</code> deveria definer AddDetailsToProducts. Se você acha que necessita mudar o nome do arquivo, então você deve atualizar o nome da classe dentro do arquivo ou então o Rails ira queixar-se que não existe a classe.</p>

<p>Internamente Rails usa apenas o numero da migração (data) para identificá-lo. Antes do Rails 2.1 os números das migrações eram iniciados em 1 e apenas incrementado cada vez que era gerado uma nova migração. Com múltiplos desenvolvedores era mais fácil haver colisões, necessitando você voltar e reordena-los. Você pode reverter para o esquema da velha numeração setando <code>config.active_record.timestamped_migrations</code>para <code>false</code>no <code>environment.rb</code>.</p>

<p>A combinação do tempo e o registro que permite executar as migrações foram a forma como o Rails fez para manipular as situações comuns que ocorrem com múltiplos desenvolvedores.</p>

<p>Por exemplo Alice adicionou a migração <code>20080906120000</code>e <code>20080906123000</code>e Bob adicionou <code>20080906124500</code> e rodou. Alice finaliza suas mudanças e checa nas suas migrações e Bob puxa as mais recentes atualizações. Rails sabe que ele não rodou as duas migrações de Alice assim <code>rake db:migrate</code> irá executá-los (Apesar que a migração do Bob seja executada uma hora mais tarde), e similarmente fazendo regressão da migração não teria executado esses dois métodos.</p>

<p>Claro que isso não substitui a comunicação dentro da equipe, por exemplo, na migração da Alice ela removeu uma tabela que Bob assumiu a existência na sua migração, então claro que um problema irá acontecer.</p>

<h3>1.3 Mudando migrações</h3>

<p>Ocasionalmente você comete um erro enquanto escrevia a migração. Se você já tiver executado a migração, então você não pode simplesmente editar e executar novamente a migração: Rails acha que a migração já foi executada, então ele não fará nada quando você rodar <code>rake db:migrate</code>. Você deve voltar a migração (por exemplo, com <code>rake db:rollback</code>), editar sua migração e rodar <code>rake db:migrate</code>para a correta versão.</p>

<p>No geral, editar migrações existentes não é uma boa idéia: você criará trabalho extra para você mesmo e para seus parceiros de trabalho e causar um maior problema se a versão da migração for rodada em uma máquina de produção. Em vez disso, você deve escrever uma nova migração para realizar as alterações que você solicita. Editando uma recém migração gerada e que ainda não foi <code>commitada</code> para o controle de versão (ou que geralmente não foi propagada além da sua máquina de desenvolvimento) é relativamente inofensivo. Apenas use com bom senso.</p>

<ul>
<li><a href="/2008/10/21/traducao--rails-database-migrations---parte-ii">Continuação: Rails Database Migrations - Parte II</a></li>
<li><a href="/2008/11/04/traducao--rails-database-migrations---parte-iii">Continuação: Rails Database Migrations - Parte III</a></li>
<li><a href="/2008/11/12/traducao--rails-database-migrations---parte-iv">Continuação: Rails Database Migrations - Parte IV</a></li>
</ul>


<p>E aqui finaliza a primeira parte deste artigo.</p>

<p>Até a próxima!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/09/19/lancado-phpunit-3-3/">Lançado PHPUnit 3.3</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-09-19T00:00:00-03:00" pubdate data-updated="true">Sep 19<span>th</span>, 2008</time>
        
         | <a href="/2008/09/19/lancado-phpunit-3-3/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Olá, na segunda feira (15/09) foi lançado a mais nova versão do <a href="http://sebastian-bergmann.de/archives/816-PHPUnit-3.3.html">PHPUnit 3.3</a>. O Changelog dessa versão trás mais detalhes sobre as nova features.</p>

<p>Até a próxima!</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/7/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/page/5/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2014/08/30/o-que-eu-nao-curti-em-go/">O que eu não curti em go</a>
      </li>
    
      <li class="post">
        <a href="/2013/09/01/rubyconf-brasil-2013/">RubyConf Brasil 2013</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/15/poro-pure-old-ruby-object/">PORO - Pure Old Ruby Object</a>
      </li>
    
      <li class="post">
        <a href="/2011/07/10/realmente-existe-diferenca-entre-tdd-e-bdd/">Realmente existe diferença entre TDD e BDD?</a>
      </li>
    
      <li class="post">
        <a href="/2011/04/01/proc-e-lambda/">Proc e lambda</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/caironoleto">@caironoleto</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'caironoleto',
            count: 10,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("caironoleto", 10, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/caironoleto" class="twitter-follow-button" data-show-count="true">Follow @caironoleto</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Cairo Noleto -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'caironoleto';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
